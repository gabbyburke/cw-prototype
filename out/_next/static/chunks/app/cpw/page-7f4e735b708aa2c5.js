(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[932],{9574:function(e,s,a){Promise.resolve().then(a.bind(a,3437))},3437:function(e,s,a){"use strict";a.r(s),a.d(s,{default:function(){return p}});var n=a(7437),t=a(2265),r=a(7648),i=a(5475),l=a(9116);function c(e){var s;let{isOpen:a,onClose:r,case_:i,onSuccess:c}=e,[o,d]=(0,t.useState)(1),[h,m]=(0,t.useState)(!1),[u,p]=(0,t.useState)(null),[x,g]=(0,t.useState)([]),[j,f]=(0,t.useState)(!1),[_,v]=(0,t.useState)(!1),[N,y]=(0,t.useState)(""),[b,C]=(0,t.useState)([]),[S,k]=(0,t.useState)(!1),[w,P]=(0,t.useState)("Parent"),[A,q]=(0,t.useState)(null),[R,M]=(0,t.useState)({first_name:"",last_name:"",date_of_birth:"",role:"Parent"}),[L,W]=(0,t.useState)({type:"",description:""}),[D,T]=(0,t.useState)({risk_level:"Medium",safety_factors:[],assessment_notes:"",risk_confirmed:!1,safety_confirmed:!1}),[B,E]=(0,t.useState)(""),[F,I]=(0,t.useState)({cpw_notes:"",ready_for_assignment:!1}),O=[{id:1,title:"Review Case Details",description:"Name case, add safety concerns, and review case information",completed:""!==L.type&&""!==L.description},{id:2,title:"Verify Case Membership",description:"Review and add people involved in the case",completed:x.length>0},{id:3,title:"Update Living Arrangements",description:"Set living arrangements for all children/clients",completed:D.risk_confirmed&&D.safety_confirmed},{id:4,title:"Request SWCM Assignment",description:"Finalize case setup and request SWCM",completed:F.ready_for_assignment}],J=e=>"cpw_assignment_".concat(e),U=()=>{if(!i)return;let e={caseId:i.case_id,currentStep:o,casePersons:x,allegations:L,assessments:D,finalConfirmation:F,lastSaved:new Date().toISOString()};localStorage.setItem(J(i.case_id),JSON.stringify(e))},G=e=>{try{let s=localStorage.getItem(J(e));return s?JSON.parse(s):null}catch(e){return console.error("Error loading saved progress:",e),null}},K=e=>{localStorage.removeItem(J(e))};(0,t.useEffect)(()=>{if(a&&i){let e=G(i.case_id);e?(d(e.currentStep),g(e.casePersons),W(e.allegations),T(e.assessments),I(e.finalConfirmation)):(g(i.persons||[]),W({type:i.allegation_type||"",description:i.allegation_description||""}),T({risk_level:i.risk_level||"Medium",safety_factors:i.safety_factors||[],assessment_notes:i.assessment_notes||"",risk_confirmed:!1,safety_confirmed:!1}),I({cpw_notes:"",ready_for_assignment:!1}),d(1)),p(null)}},[a,i]),(0,t.useEffect)(()=>{if(a&&i){let e=setTimeout(()=>{U()},1e3);return()=>clearTimeout(e)}},[a,i,o,x,L,D,F]);let H=e=>{g(x.filter(s=>s.person_id!==e))},Y=async e=>{if(e.length<2){C([]);return}k(!0);try{let s=await (0,l.Kj)(e);s.error?(p(s.error),C([])):s.data&&C(s.data.persons)}catch(e){p("Failed to search persons"),C([])}finally{k(!1)}},z=e=>{if(x.some(s=>s.person_id===e.person_id)){p("This person is already added to the case");return}g([...x,{...e,role:w.toLowerCase(),relationship_to_primary_child:w}]),v(!1),y(""),C([]),p(null)};(0,t.useEffect)(()=>{if(N){let e=setTimeout(()=>{Y(N)},300);return()=>clearTimeout(e)}C([])},[N]);let V=async()=>{if(i){m(!0),p(null);try{let e={allegation_type:L.type,allegation_description:L.description,risk_level:D.risk_level,safety_factors:D.safety_factors,assessment_notes:D.assessment_notes,status:"Pending Assignment"},s=await (0,l.$4)(i.case_id,e);s.error?p(s.error):(K(i.case_id),c(),r())}catch(e){p("Failed to request SWCM assignment")}finally{m(!1)}}};return a&&i?(0,n.jsx)("div",{className:"modal-overlay",onClick:e=>{e.target===e.currentTarget&&r()},children:(0,n.jsxs)("div",{className:"modal-container large scrollable",children:[(0,n.jsxs)("div",{className:"modal-header",children:[(0,n.jsxs)("h2",{children:["Request SWCM Assignment - ",i.case_display_name||"Case ".concat(i.case_id)]}),(0,n.jsx)("button",{onClick:r,className:"modal-close",children:(0,n.jsx)("span",{className:"icon",children:"close"})})]}),(0,n.jsxs)("div",{className:"modal-body",children:[(0,n.jsxs)("div",{className:"progress-bar-container",children:[(0,n.jsx)("div",{className:"progress-bar",children:(0,n.jsx)("div",{className:"progress-fill",style:{width:"".concat(o/O.length*100,"%")}})}),(0,n.jsxs)("div",{className:"progress-text",children:["Step ",o," of ",O.length,": ",null===(s=O[o-1])||void 0===s?void 0:s.title]})]}),(0,n.jsx)("div",{className:"setup-progress",children:O.map(e=>(0,n.jsxs)("div",{className:"progress-step ".concat(o===e.id?"active":""," ").concat(e.completed?"completed":""," clickable"),onClick:()=>d(e.id),children:[(0,n.jsx)("div",{className:"step-number",children:e.completed?(0,n.jsx)("span",{className:"icon",children:"check"}):e.id}),(0,n.jsxs)("div",{className:"step-info",children:[(0,n.jsx)("h4",{children:e.title}),(0,n.jsx)("p",{children:e.description})]})]},e.id))}),(0,n.jsxs)("div",{className:"modal-content",children:[u&&(0,n.jsxs)("div",{className:"error-message",children:[(0,n.jsx)("span",{className:"icon",children:"error"}),u]}),1===o&&(0,n.jsxs)("div",{className:"setup-step",children:[(0,n.jsx)("h3",{children:"Step 1: Review Case Details"}),(0,n.jsx)("p",{children:"Name this case, add family safety concerns, and review case information before requesting SWCM assignment."}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Name this case *"}),(0,n.jsx)("input",{type:"text",value:L.description,onChange:e=>W({...L,description:e.target.value}),placeholder:"Enter a descriptive name for this case..."})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Add family safety concerns"}),(0,n.jsx)("textarea",{value:D.assessment_notes,onChange:e=>T({...D,assessment_notes:e.target.value}),placeholder:"Describe any family safety concerns...",rows:3})]}),(0,n.jsxs)("div",{className:"form-grid",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Safety Plan"}),(0,n.jsxs)("div",{className:"radio-group",children:[(0,n.jsxs)("label",{children:[(0,n.jsx)("input",{type:"radio",name:"safety_plan",value:"yes",checked:D.safety_factors.includes("Safety Plan Required"),onChange:e=>{e.target.checked&&T({...D,safety_factors:[...D.safety_factors.filter(e=>!e.includes("Safety Plan")),"Safety Plan Required"]})}}),"Yes"]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("input",{type:"radio",name:"safety_plan",value:"no",checked:!D.safety_factors.includes("Safety Plan Required"),onChange:e=>{e.target.checked&&T({...D,safety_factors:D.safety_factors.filter(e=>!e.includes("Safety Plan"))})}}),"No"]})]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Family Preservation"}),(0,n.jsxs)("div",{className:"radio-group",children:[(0,n.jsxs)("label",{children:[(0,n.jsx)("input",{type:"radio",name:"family_preservation",value:"yes",checked:D.safety_factors.includes("Family Preservation Services"),onChange:e=>{e.target.checked&&T({...D,safety_factors:[...D.safety_factors.filter(e=>!e.includes("Family Preservation")),"Family Preservation Services"]})}}),"Yes"]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("input",{type:"radio",name:"family_preservation",value:"no",checked:!D.safety_factors.includes("Family Preservation Services"),onChange:e=>{e.target.checked&&T({...D,safety_factors:D.safety_factors.filter(e=>!e.includes("Family Preservation"))})}}),"No"]})]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Prior Service Case"}),(0,n.jsxs)("div",{className:"radio-group",children:[(0,n.jsxs)("label",{children:[(0,n.jsx)("input",{type:"radio",name:"prior_service",value:"yes",checked:D.safety_factors.includes("Prior Service Case"),onChange:e=>{e.target.checked&&T({...D,safety_factors:[...D.safety_factors.filter(e=>!e.includes("Prior Service")),"Prior Service Case"]})}}),"Yes"]}),(0,n.jsxs)("label",{children:[(0,n.jsx)("input",{type:"radio",name:"prior_service",value:"no",checked:!D.safety_factors.includes("Prior Service Case"),onChange:e=>{e.target.checked&&T({...D,safety_factors:D.safety_factors.filter(e=>!e.includes("Prior Service"))})}}),"No"]})]})]})]}),(0,n.jsxs)("div",{className:"form-grid",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Service Area Assigned"}),(0,n.jsx)("input",{type:"text",value:L.type,onChange:e=>W({...L,type:e.target.value}),placeholder:"Will be pre-filled from Magic Button",disabled:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Residence County"}),(0,n.jsx)("input",{type:"text",value:(null==i?void 0:i.county)||"",placeholder:"Will be pre-filled from Magic Button",disabled:!0})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Financial County"}),(0,n.jsx)("input",{type:"text",value:(null==i?void 0:i.county)||"",placeholder:"Will be pre-filled from Magic Button",disabled:!0})]})]})]}),2===o&&(0,n.jsxs)("div",{className:"setup-step",children:[(0,n.jsx)("h3",{children:"Step 2: Verify Case Membership"}),(0,n.jsx)("p",{children:"Review the people involved in this case and add any missing individuals before assignment."}),(0,n.jsx)("div",{className:"persons-list",children:x.map(e=>(0,n.jsxs)("div",{className:"person-item",children:[(0,n.jsxs)("div",{className:"person-info",children:[(0,n.jsxs)("strong",{children:[e.first_name," ",e.last_name]}),(0,n.jsx)("span",{className:"person-role",children:e.role}),e.date_of_birth&&(0,n.jsxs)("span",{className:"person-age",children:["Age: ",Math.floor((new Date().getTime()-new Date(e.date_of_birth).getTime())/315576e5)]})]}),(0,n.jsxs)("button",{onClick:()=>H(e.person_id),className:"action-btn small error",children:[(0,n.jsx)("span",{className:"icon",children:"remove"}),"Remove"]})]},e.person_id))}),(0,n.jsxs)("div",{className:"person-search-section",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Search for a person or add new"}),(0,n.jsx)("input",{type:"text",value:N,onChange:e=>y(e.target.value),placeholder:"Start typing a person's name..."})]}),S&&(0,n.jsxs)("div",{className:"search-loading",children:[(0,n.jsx)("span",{className:"icon",children:"hourglass_empty"}),"Searching..."]}),b.length>0&&(0,n.jsxs)("div",{className:"search-results",children:[(0,n.jsxs)("h5",{children:["Found ",b.length," person(s)"]}),b.map(e=>{var s;return(0,n.jsxs)("div",{className:"search-result-item",children:[(0,n.jsxs)("div",{className:"person-info",children:[(0,n.jsxs)("strong",{children:[e.first_name," ",e.last_name]}),e.date_of_birth&&(0,n.jsxs)("span",{className:"person-age",children:["Age: ",Math.floor((new Date().getTime()-new Date(e.date_of_birth).getTime())/315576e5)]}),(null===(s=e.contact_info)||void 0===s?void 0:s.address)&&(0,n.jsx)("span",{className:"person-address",children:e.contact_info.address})]}),(0,n.jsx)("button",{onClick:()=>{x.some(s=>s.person_id===e.person_id)||(v(!0),P("Parent"),q(e))},className:"action-btn small primary",disabled:x.some(s=>s.person_id===e.person_id),children:x.some(s=>s.person_id===e.person_id)?"Already Added":"Select"})]},e.person_id)})]}),N.length>=2&&!S&&0===b.length&&(0,n.jsx)("div",{className:"no-results",children:(0,n.jsxs)("div",{className:"no-results-content",children:[(0,n.jsx)("span",{className:"icon",children:"search_off"}),(0,n.jsxs)("p",{children:['No persons found matching "',N,'"']}),(0,n.jsxs)("button",{onClick:()=>f(!0),className:"action-btn primary",children:[(0,n.jsx)("span",{className:"icon",children:"person_add"}),'Add "',N,'" as New Person']})]})}),0===N.length&&(0,n.jsxs)("div",{className:"search-help",children:[(0,n.jsx)("p",{children:"Start typing to search for existing people, or"}),(0,n.jsxs)("button",{onClick:()=>f(!0),className:"action-btn secondary",children:[(0,n.jsx)("span",{className:"icon",children:"person_add"}),"Add New Person"]})]})]}),_&&A&&(0,n.jsxs)("div",{className:"role-selection-form",children:[(0,n.jsxs)("h4",{children:["Select Role for ",A.first_name," ",A.last_name]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Role in Case"}),(0,n.jsxs)("select",{value:w,onChange:e=>P(e.target.value),children:[(0,n.jsx)("option",{value:"Parent",children:"Parent"}),(0,n.jsx)("option",{value:"Non-Resident Parent",children:"Non-Resident Parent"}),(0,n.jsx)("option",{value:"Client",children:"Client"}),(0,n.jsx)("option",{value:"Guardian",children:"Guardian"}),(0,n.jsx)("option",{value:"Relative",children:"Relative"}),(0,n.jsx)("option",{value:"Family Support",children:"Family Support"})]})]}),(0,n.jsxs)("div",{className:"form-actions",children:[(0,n.jsxs)("button",{onClick:()=>{z(A),v(!1),q(null)},className:"action-btn primary",children:[(0,n.jsx)("span",{className:"icon",children:"add"}),"Add to Case"]}),(0,n.jsx)("button",{onClick:()=>{v(!1),q(null)},className:"action-btn secondary",children:"Cancel"})]})]}),j&&(0,n.jsxs)("div",{className:"add-person-form",children:[(0,n.jsx)("h4",{children:"Add New Person"}),(0,n.jsxs)("div",{className:"form-grid",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"First Name *"}),(0,n.jsx)("input",{type:"text",value:R.first_name,onChange:e=>M({...R,first_name:e.target.value}),placeholder:"Enter first name"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Last Name *"}),(0,n.jsx)("input",{type:"text",value:R.last_name,onChange:e=>M({...R,last_name:e.target.value}),placeholder:"Enter last name"})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Date of Birth"}),(0,n.jsx)("input",{type:"date",value:R.date_of_birth,onChange:e=>M({...R,date_of_birth:e.target.value})})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Relationship to Case *"}),(0,n.jsxs)("select",{value:R.role,onChange:e=>M({...R,role:e.target.value}),children:[(0,n.jsx)("option",{value:"Parent",children:"Parent"}),(0,n.jsx)("option",{value:"Non-Resident Parent",children:"Non-Resident Parent"}),(0,n.jsx)("option",{value:"Client",children:"Client"}),(0,n.jsx)("option",{value:"Guardian",children:"Guardian"}),(0,n.jsx)("option",{value:"Relative",children:"Relative"}),(0,n.jsx)("option",{value:"Family Support",children:"Family Support"})]})]})]}),(0,n.jsxs)("div",{className:"form-actions",children:[(0,n.jsxs)("button",{onClick:()=>{if(!R.first_name||!R.last_name){p("First name and last name are required");return}g([...x,{person_id:"temp_".concat(Date.now()),first_name:R.first_name,last_name:R.last_name,date_of_birth:R.date_of_birth,role:R.role.toLowerCase(),contact_info:{phone:void 0,email:void 0,address:void 0},indicators:[],relationship_to_primary_child:R.role}]),M({first_name:"",last_name:"",date_of_birth:"",role:"Parent"}),f(!1),p(null)},className:"action-btn primary",children:[(0,n.jsx)("span",{className:"icon",children:"add"}),"Add Person"]}),(0,n.jsx)("button",{onClick:()=>f(!1),className:"action-btn secondary",children:"Cancel"})]})]})]}),3===o&&(0,n.jsxs)("div",{className:"setup-step",children:[(0,n.jsx)("h3",{children:"Step 3: Update Living Arrangements"}),(0,n.jsx)("p",{children:"Set living arrangements for all children/clients before requesting SWCM assignment."}),(0,n.jsx)("div",{className:"living-arrangements-section",children:x.filter(e=>"client"===e.role.toLowerCase()||"child"===e.role.toLowerCase()).length>0?x.filter(e=>"client"===e.role.toLowerCase()||"child"===e.role.toLowerCase()).map(e=>(0,n.jsxs)("div",{className:"child-living-arrangement",children:[(0,n.jsxs)("h4",{children:[e.first_name," ",e.last_name]}),(0,n.jsxs)("div",{className:"form-grid",children:[(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Living Arrangement Type *"}),(0,n.jsxs)("select",{value:"",onChange:s=>{console.log("Living arrangement for ".concat(e.first_name,": ").concat(s.target.value))},children:[(0,n.jsx)("option",{value:"",children:"Select arrangement type"}),(0,n.jsx)("option",{value:"With Parent/Guardian",children:"With Parent/Guardian"}),(0,n.jsx)("option",{value:"Foster Care",children:"Foster Care"}),(0,n.jsx)("option",{value:"Kinship Care",children:"Kinship Care"}),(0,n.jsx)("option",{value:"Group Home",children:"Group Home"}),(0,n.jsx)("option",{value:"Residential Treatment",children:"Residential Treatment"}),(0,n.jsx)("option",{value:"Independent Living",children:"Independent Living"}),(0,n.jsx)("option",{value:"Other",children:"Other"})]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Name and Location *"}),(0,n.jsx)("input",{type:"text",placeholder:"Enter caregiver name and location",onChange:s=>{console.log("Location for ".concat(e.first_name,": ").concat(s.target.value))}})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"Start Date *"}),(0,n.jsx)("input",{type:"date",onChange:s=>{console.log("Start date for ".concat(e.first_name,": ").concat(s.target.value))}})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"End Date"}),(0,n.jsx)("input",{type:"date",onChange:s=>{console.log("End date for ".concat(e.first_name,": ").concat(s.target.value))}})]})]})]},e.person_id)):(0,n.jsxs)("div",{className:"no-children-notice",children:[(0,n.jsx)("span",{className:"icon",children:"info"}),(0,n.jsx)("p",{children:"No children/clients found in this case. Please add children in Step 2 before requesting assignment."})]})}),(0,n.jsx)("div",{className:"form-group",children:(0,n.jsxs)("label",{children:[(0,n.jsx)("input",{type:"checkbox",checked:D.risk_confirmed,onChange:e=>T({...D,risk_confirmed:e.target.checked})}),"I confirm all living arrangements have been reviewed and updated"]})})]}),4===o&&(0,n.jsxs)("div",{className:"setup-step",children:[(0,n.jsx)("h3",{children:"Step 4: Request SWCM Assignment"}),(0,n.jsx)("p",{children:"Review all information and request assignment to a Social Work Case Manager."}),(0,n.jsxs)("div",{className:"setup-summary",children:[(0,n.jsx)("h4",{children:"Assignment Request Summary"}),(0,n.jsxs)("div",{className:"summary-item",children:[(0,n.jsx)("strong",{children:"People Involved:"})," ",x.length," person(s)"]}),(0,n.jsxs)("div",{className:"summary-item",children:[(0,n.jsx)("strong",{children:"Allegation:"})," ",L.type]}),(0,n.jsxs)("div",{className:"summary-item",children:[(0,n.jsx)("strong",{children:"Risk Level:"})," ",D.risk_level]}),(0,n.jsxs)("div",{className:"summary-item",children:[(0,n.jsx)("strong",{children:"Ready for Assignment:"})," ",D.risk_confirmed?"Yes":"No"]})]}),(0,n.jsxs)("div",{className:"form-group",children:[(0,n.jsx)("label",{children:"CPW Notes (Optional)"}),(0,n.jsx)("textarea",{value:F.cpw_notes,onChange:e=>I({...F,cpw_notes:e.target.value}),placeholder:"Add any additional notes for the SWCM...",rows:3})]}),(0,n.jsx)("div",{className:"form-group",children:(0,n.jsxs)("label",{children:[(0,n.jsx)("input",{type:"checkbox",checked:F.ready_for_assignment,onChange:e=>I({...F,ready_for_assignment:e.target.checked})}),"I confirm this case is ready for SWCM assignment and all required information has been reviewed"]})})]})]})]}),(0,n.jsx)("div",{className:"modal-footer",children:(0,n.jsxs)("div",{className:"modal-actions",children:[(0,n.jsx)("button",{onClick:r,className:"action-btn secondary",children:"Cancel"}),o>1&&(0,n.jsxs)("button",{onClick:()=>{o>1&&d(o-1)},className:"action-btn secondary",children:[(0,n.jsx)("span",{className:"icon",children:"arrow_back"}),"Previous"]}),o<4?(0,n.jsxs)("button",{onClick:()=>{o<4&&d(o+1)},className:"action-btn primary",children:["Next",(0,n.jsx)("span",{className:"icon",children:"arrow_forward"})]}):(0,n.jsxs)("button",{onClick:V,className:"action-btn primary",disabled:!F.ready_for_assignment||h,children:[h?"Requesting Assignment...":"Request SWCM Assignment",(0,n.jsx)("span",{className:"icon",children:"assignment_ind"})]})]})})]})}):null}function o(e){let{percentage:s,size:a="medium",showText:t=!0,text:r,className:i=""}=e,l=Math.max(0,Math.min(100,s));return(0,n.jsxs)("div",{className:"progress-container ".concat(i),children:[(0,n.jsx)("div",{className:{small:"progress-bar-small",medium:"progress-bar",large:"progress-bar-large"}[a],children:(0,n.jsx)("div",{className:{small:"progress-fill-small",medium:"progress-fill",large:"progress-fill-large"}[a],style:{width:"".concat(l,"%")}})}),t&&(0,n.jsx)("div",{className:{small:"progress-text-small",medium:"progress-text",large:"progress-text-large"}[a],children:r||"".concat(Math.round(l),"%")})]})}let d=["initial_assessment","persons_verified","living_arrangements","safety_plan","case_notes","supervisor_review"],h=e=>{try{let s=localStorage.getItem("case_setup_".concat(e));if(!s)return{completed:[],percentage:0,step:0,total:d.length};let a=JSON.parse(s).completedMilestones||[],n=Math.round(a.length/d.length*100);return{completed:a,percentage:n,step:a.length,total:d.length}}catch(e){return{completed:[],percentage:0,step:0,total:d.length}}},m={"request-assignment":{title:"Ready to Request SWCM Assignment",columns:["Incident Number","Intake Date","Key Allegation","Actions"],actionButton:{text:"Request Assignment",icon:"assignment_ind",className:"primary"}},"edits-required":{title:"Edits Required",columns:["Case Name","Last Updated","Supervisor Note","Actions"],actionButton:{text:"View & Edit",icon:"edit",className:"error"}},"case-setup":{title:"Ready for Setup",columns:["Case Name","Assigned SWCM","Setup Progress","Actions"],actionButton:{text:"Start Setup",icon:"settings",className:"secondary"}}};function u(e){let{taskType:s,cases:a,onActionClick:t}=e,i=m[s];if(!i)return(0,n.jsx)("div",{className:"task-table-container",children:(0,n.jsxs)("div",{className:"error-message",children:[(0,n.jsx)("span",{className:"icon",children:"error"}),"Unknown task type: ",s]})});let l=(e,a)=>{switch(s){case"request-assignment":switch(a){case 0:return(0,n.jsx)("div",{className:"case-name-cell",children:(0,n.jsx)(r.default,{href:"/cases/".concat(e.case_id),className:"case-link",children:(0,n.jsx)("strong",{children:e.case_number})})});case 1:return new Date(e.created_date).toLocaleDateString();case 2:return(0,n.jsxs)("div",{className:"allegation-cell",children:[(0,n.jsx)("span",{className:"allegation-type",children:e.allegation_type}),(0,n.jsx)("div",{className:"allegation-desc",children:e.allegation_description})]});case 3:return(0,n.jsxs)("button",{onClick:()=>t(e),className:"action-btn small ".concat(i.actionButton.className),title:i.actionButton.text,children:[(0,n.jsx)("span",{className:"icon",children:i.actionButton.icon}),i.actionButton.text]});default:return null}case"edits-required":switch(a){case 0:return(0,n.jsxs)("div",{className:"case-name-cell",children:[(0,n.jsx)(r.default,{href:"/cases/".concat(e.case_id),className:"case-link",children:(0,n.jsx)("strong",{children:e.case_display_name||e.family_name})}),(0,n.jsx)("div",{className:"case-number",children:e.case_number})]});case 1:return new Date(e.created_date).toLocaleDateString();case 2:return"Placeholder for supervisor feedback";case 3:return(0,n.jsxs)("button",{onClick:()=>t(e),className:"action-btn small ".concat(i.actionButton.className),title:i.actionButton.text,children:[(0,n.jsx)("span",{className:"icon",children:i.actionButton.icon}),i.actionButton.text]});default:return null}case"case-setup":switch(a){case 0:return(0,n.jsxs)("div",{className:"case-name-cell",children:[(0,n.jsx)(r.default,{href:"/cases/".concat(e.case_id),className:"case-link",children:(0,n.jsx)("strong",{children:e.case_display_name||e.family_name})}),(0,n.jsx)("div",{className:"case-number",children:e.case_number})]});case 1:return e.assigned_worker||"Unassigned";case 2:let l=h(e.case_id);return(0,n.jsx)(o,{percentage:l.percentage,size:"small",text:"".concat(l.step,"/").concat(l.total," Steps")});case 3:return(0,n.jsxs)("button",{onClick:()=>t(e),className:"action-btn small ".concat(i.actionButton.className),title:i.actionButton.text,children:[(0,n.jsx)("span",{className:"icon",children:i.actionButton.icon}),i.actionButton.text]});default:return null}default:return null}};return(0,n.jsxs)("div",{className:"task-table-container",children:[(0,n.jsxs)("div",{className:"task-table-header",children:[(0,n.jsx)("h3",{className:"task-table-title",children:i.title}),(0,n.jsxs)("div",{className:"task-table-count",children:[a.length," cases"]})]}),a.length>0?(0,n.jsx)("div",{className:"table-container",children:(0,n.jsxs)("table",{className:"data-table task-table",children:[(0,n.jsx)("thead",{children:(0,n.jsx)("tr",{children:i.columns.map((e,s)=>(0,n.jsx)("th",{children:e},s))})}),(0,n.jsx)("tbody",{children:a.map(e=>(0,n.jsx)("tr",{children:i.columns.map((s,a)=>(0,n.jsx)("td",{children:l(e,a)},a))},e.case_id))})]})}):(0,n.jsxs)("div",{className:"empty-state",children:[(0,n.jsx)("span",{className:"icon large",children:"check_circle"}),(0,n.jsx)("h3",{children:"No Cases in Queue"}),(0,n.jsx)("p",{children:"All cases for this task have been completed."})]})]})}function p(){let e=(0,i.useRouter)(),[s,a]=(0,t.useState)(["Draft Cases"]),[o,d]=(0,t.useState)([]),[h,m]=(0,t.useState)(!0),[p,x]=(0,t.useState)(null),[g,j]=(0,t.useState)(!1),[f,_]=(0,t.useState)(null),[v,N]=(0,t.useState)(null);(0,t.useEffect)(()=>{y()},[]);let y=async()=>{m(!0),x(null);let e=await (0,l.tW)("unassigned");e.error?x(e.error):e.data&&d(e.data.cases),m(!1)},b=e=>{switch(e.toLowerCase()){case"allergy":return"medical_services";case"icwa eligible":return"diversity_3";case"runaway":return"directions_run";case"worker safety":return"security";case"protective order":return"gavel";case"icpc":return"swap_horiz";case"safe haven":return"shield";case"chronic medical condition":return"local_hospital";default:return"flag"}},C=e=>{switch(e.toLowerCase()){case"allergy":case"runaway":case"worker safety":return"error";case"icwa eligible":return"tertiary";case"protective order":case"chronic medical condition":return"secondary";default:return"primary"}},S=e=>{if(!e.persons)return null;let s=e.persons.filter(e=>"Client"===e.role);return 0===s.length?null:s.map((e,a)=>(0,n.jsxs)("span",{children:[(0,n.jsxs)(r.default,{href:"/persons/".concat(e.person_id),className:"child-link",children:[e.first_name," ",e.last_name]}),a<s.length-1&&", "]},e.person_id))},k=e=>{let s=new Set;return e.persons&&e.persons.forEach(e=>{e.indicators&&e.indicators.forEach(e=>s.add(e))}),Array.from(s)},w=e=>{_(e),j(!0)},P=s=>{e.push("/cases/".concat(s.case_id))},A=e=>{try{let s=localStorage.getItem("cpw_setup_".concat(e));return null!==s}catch(e){return!1}},q=e=>{try{let s=localStorage.getItem("cpw_setup_".concat(e));if(!s)return{step:0,total:4,percentage:0};let a=JSON.parse(s).currentStep||1;return{step:a,total:4,percentage:Math.round(a/4*100)}}catch(e){return{step:0,total:4,percentage:0}}},R=e=>{v===e?N(null):N(e)},M=[{id:"pending-assignment",label:"Pending Assignment",status:["Pending Assignment"],count:o.filter(e=>"Pending Assignment"===e.status).length},{id:"pending-approval",label:"Pending Approval",status:["Pending Approval"],count:o.filter(e=>"Pending Approval"===e.status).length},{id:"ready-swcm-assignment",label:"Ready for SWCM Assignment",status:["Draft"],count:o.filter(e=>"Draft"===e.status).length},{id:"case-setup",label:"Case Setup",status:["Case Setup"],count:o.filter(e=>"Case Setup"===e.status).length},{id:"active",label:"Active",status:["Active"],count:o.filter(e=>"Active"===e.status).length}],L=e=>{let s=M.find(s=>s.id===e);s&&a(e=>e.includes(s.label)?e.filter(e=>e!==s.label):[...e,s.label])},W=o.filter(e=>0===s.length||M.some(a=>s.includes(a.label)&&a.status.includes(e.status))),D=e=>{switch(e.status){case"Draft":return(0,n.jsxs)("button",{onClick:()=>w(e),className:"action-btn small primary",title:"Request SWCM Assignment",children:[(0,n.jsx)("span",{className:"icon",children:"assignment_ind"}),"Request Assignment"]});case"Pending Assignment":return(0,n.jsxs)("button",{className:"action-btn small secondary",disabled:!0,title:"Waiting for SWCM assignment",children:[(0,n.jsx)("span",{className:"icon",children:"hourglass_empty"}),"Pending"]});case"Case Setup":return(0,n.jsxs)("button",{onClick:()=>P(e),className:"action-btn small primary",title:A(e.case_id)?"Resume case setup progress":"Start comprehensive case setup",children:[(0,n.jsx)("span",{className:"icon",children:A(e.case_id)?"play_arrow":"settings"}),A(e.case_id)?"Resume Setup":"Start Setup"]});case"Pending Approval":return(0,n.jsxs)("button",{className:"action-btn small secondary",disabled:!0,title:"Case setup complete, awaiting supervisor approval",children:[(0,n.jsx)("span",{className:"icon",children:"pending"}),"Awaiting Approval"]});case"Active":case"Closed":return(0,n.jsxs)(r.default,{href:"/cases/".concat(e.case_id),className:"action-btn small primary",children:[(0,n.jsx)("span",{className:"icon",children:"visibility"}),"View"]});default:return(0,n.jsxs)("button",{className:"action-btn small secondary",disabled:!0,children:[(0,n.jsx)("span",{className:"icon",children:"help"}),"Unknown Status"]})}};return h?(0,n.jsx)("div",{className:"page-container",children:(0,n.jsxs)("div",{className:"page-header",children:[(0,n.jsx)("h1",{className:"page-title",children:"CPW Dashboard"}),(0,n.jsx)("p",{className:"page-description",children:"Loading cases..."})]})}):(0,n.jsxs)("div",{className:"page-container",children:[(0,n.jsxs)("div",{className:"page-header modern-header",children:[(0,n.jsx)("h1",{className:"greeting-title",children:"Hi Dana! What can I help you with today?"}),(0,n.jsx)("div",{className:"search-container",children:(0,n.jsxs)("div",{className:"search-bar",children:[(0,n.jsx)("span",{className:"search-icon icon",children:"search"}),(0,n.jsx)("input",{type:"text",className:"search-input",placeholder:"Ask me anything about your cases, or search for specific information..."}),(0,n.jsx)("button",{className:"search-submit",children:(0,n.jsx)("span",{className:"icon",children:"send"})})]})})]}),(0,n.jsxs)("div",{className:"content-wrapper",children:[(0,n.jsxs)("div",{className:"my-tasks-section",children:[(0,n.jsx)("h2",{className:"section-title",children:"My Tasks"}),(0,n.jsxs)("div",{className:"task-cards-grid",children:[(0,n.jsxs)("div",{className:"task-card primary ".concat("request-assignment"===v?"active":""),onClick:()=>R("request-assignment"),children:[(0,n.jsx)("div",{className:"task-card-icon",children:(0,n.jsx)("span",{className:"icon",children:"assignment_ind"})}),(0,n.jsxs)("div",{className:"task-card-content",children:[(0,n.jsx)("h3",{children:"Ready to Request SWCM Assignment"}),(0,n.jsxs)("p",{className:"task-count",children:[o.filter(e=>"draft"===e.status.toLowerCase()).length," cases"]}),(0,n.jsx)("p",{className:"task-description",children:"New cases ready for assignment request"})]}),(0,n.jsx)("div",{className:"task-card-action",children:(0,n.jsx)("span",{className:"icon",children:"arrow_forward"})})]}),(0,n.jsxs)("div",{className:"task-card secondary ".concat("case-setup"===v?"active":""),onClick:()=>R("case-setup"),children:[(0,n.jsx)("div",{className:"task-card-icon",children:(0,n.jsx)("span",{className:"icon",children:"settings"})}),(0,n.jsxs)("div",{className:"task-card-content",children:[(0,n.jsx)("h3",{children:"Ready for Setup"}),(0,n.jsxs)("p",{className:"task-count",children:[o.filter(e=>"case setup"===e.status.toLowerCase()).length," cases"]}),(0,n.jsx)("p",{className:"task-description",children:"Cases assigned and ready for setup"})]}),(0,n.jsx)("div",{className:"task-card-action",children:(0,n.jsx)("span",{className:"icon",children:"arrow_forward"})})]}),(0,n.jsxs)("div",{className:"task-card error ".concat("edits-required"===v?"active":""),onClick:()=>R("edits-required"),children:[(0,n.jsx)("div",{className:"task-card-icon",children:(0,n.jsx)("span",{className:"icon",children:"edit"})}),(0,n.jsxs)("div",{className:"task-card-content",children:[(0,n.jsx)("h3",{children:"Edits Required"}),(0,n.jsxs)("p",{className:"task-count",children:[o.filter(e=>"edits required"===e.status.toLowerCase()).length," cases"]}),(0,n.jsx)("p",{className:"task-description",children:"Cases returned by supervisor for changes"})]}),(0,n.jsx)("div",{className:"task-card-action",children:(0,n.jsx)("span",{className:"icon",children:"arrow_forward"})})]})]})]}),v?(0,n.jsx)(u,{taskType:v,cases:(e=>{switch(e){case"request-assignment":return o.filter(e=>"draft"===e.status.toLowerCase());case"edits-required":return o.filter(e=>"edits required"===e.status.toLowerCase());case"case-setup":return o.filter(e=>"case setup"===e.status.toLowerCase());default:return[]}})(v),onActionClick:e=>{"request-assignment"===v?w(e):"edits-required"===v?console.log("Handle edits required for case:",e.case_id):"case-setup"===v&&P(e)}}):(0,n.jsxs)("div",{className:"filter-container",children:[(0,n.jsxs)("div",{className:"filter-header",children:[(0,n.jsx)("h3",{className:"section-subtitle",children:"My Cases"}),(0,n.jsxs)("div",{className:"filter-actions",children:[(0,n.jsxs)("button",{className:"action-btn secondary",onClick:()=>a([]),disabled:0===s.length,children:[(0,n.jsx)("span",{className:"icon",children:"clear_all"}),"Clear Filters"]}),(0,n.jsxs)("button",{className:"action-btn primary",onClick:y,children:[(0,n.jsx)("span",{className:"icon",children:"refresh"}),"Refresh"]})]})]}),(0,n.jsx)("div",{className:"filter-tags",children:M.map(e=>(0,n.jsxs)("button",{onClick:()=>L(e.id),className:"filter-tag ".concat(s.includes(e.label)?"active":""),disabled:0===e.count,children:[(0,n.jsx)("span",{className:"tag-label",children:e.label}),(0,n.jsxs)("span",{className:"tag-count",children:["(",e.count,")"]})]},e.id))})]}),!v&&(0,n.jsx)("div",{className:"content-area",children:(0,n.jsxs)("div",{className:"card",children:[(0,n.jsxs)("div",{className:"card-header",children:[(0,n.jsxs)("h2",{children:[0===s.length?"My Cases":1===s.length?s[0]:"".concat(s.length," Filters Active"),s.length>1&&(0,n.jsxs)("span",{className:"filter-summary",children:[" (",s.join(", "),")"]})]}),(0,n.jsx)("div",{className:"card-actions",children:(0,n.jsxs)("span",{className:"case-count",children:[W.length," cases"]})})]}),(0,n.jsxs)("div",{className:"card-content",children:[p&&(0,n.jsxs)("div",{className:"error-message",children:[(0,n.jsx)("span",{className:"icon",children:"error"}),p]}),W.length>0?(0,n.jsx)("div",{className:"table-container",children:(0,n.jsxs)("table",{className:"data-table",children:[(0,n.jsx)("thead",{children:(0,n.jsxs)("tr",{children:[(0,n.jsx)("th",{children:"Case Name"}),(0,n.jsx)("th",{children:"Status"}),(0,n.jsx)("th",{children:"Intake Date"}),(0,n.jsx)("th",{children:"Key Allegations"}),(0,n.jsx)("th",{children:"Children Involved"}),(0,n.jsx)("th",{children:"Indicators"}),(0,n.jsx)("th",{children:"Progress"}),(0,n.jsx)("th",{children:"Assigned Workers"}),(0,n.jsx)("th",{children:"Actions"})]})}),(0,n.jsx)("tbody",{children:W.map(e=>(0,n.jsxs)("tr",{children:[(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"case-name-cell",children:[(0,n.jsx)(r.default,{href:"/cases/".concat(e.case_id),className:"case-link",children:(0,n.jsx)("strong",{children:e.case_display_name||e.family_name})}),(0,n.jsx)("div",{className:"case-number",children:e.case_number})]})}),(0,n.jsx)("td",{children:(0,n.jsx)("span",{className:"status-badge ".concat(e.status.toLowerCase().replace(/\s+/g,"-")),children:e.status})}),(0,n.jsx)("td",{children:new Date(e.created_date).toLocaleDateString()}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"allegation-cell",children:[(0,n.jsx)("span",{className:"allegation-type",children:e.allegation_type}),(0,n.jsx)("div",{className:"allegation-desc",children:e.allegation_description})]})}),(0,n.jsx)("td",{children:(0,n.jsx)("div",{className:"children-list",children:S(e)||"No children listed"})}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"indicators-cell",children:[k(e).slice(0,3).map((e,s)=>(0,n.jsxs)("span",{className:"indicator-badge ".concat(C(e)),title:e,children:[(0,n.jsx)("span",{className:"icon",children:b(e)}),e]},s)),k(e).length>3&&(0,n.jsxs)("span",{className:"indicator-more",children:["+",k(e).length-3," more"]})]})}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"progress-cell",children:["Case Setup"===e.status&&(()=>{let s=q(e.case_id);return(0,n.jsxs)("div",{className:"setup-progress-indicator",children:[(0,n.jsx)("div",{className:"progress-bar-small",children:(0,n.jsx)("div",{className:"progress-fill-small",style:{width:"".concat(s.percentage,"%")}})}),(0,n.jsx)("div",{className:"progress-text-small",children:s.step>0?"Step ".concat(s.step,"/").concat(s.total):"Not Started"})]})})(),"Case Setup"!==e.status&&(0,n.jsx)("span",{className:"progress-na",children:"—"})]})}),(0,n.jsx)("td",{children:(0,n.jsxs)("div",{className:"workers-cell",children:[(0,n.jsxs)("div",{className:"primary-worker",children:[(0,n.jsx)("strong",{children:"Primary:"})," ",e.assigned_worker||"Unassigned"]}),e.assigned_supervisor&&(0,n.jsxs)("div",{className:"supervisor",children:[(0,n.jsx)("strong",{children:"Supervisor:"})," ",e.assigned_supervisor]})]})}),(0,n.jsx)("td",{children:(0,n.jsx)("div",{className:"action-buttons",children:D(e)})})]},e.case_id))})]})}):(0,n.jsxs)("div",{className:"empty-state",children:[(0,n.jsx)("span",{className:"icon large",children:"filter_list"}),(0,n.jsx)("h3",{children:"No Cases Match Current Filters"}),(0,n.jsx)("p",{children:0===s.length?"No cases found in the system":"Try adjusting your filters or clearing them to see more cases"}),s.length>0&&(0,n.jsxs)("button",{className:"action-btn primary",onClick:()=>a([]),children:[(0,n.jsx)("span",{className:"icon",children:"clear_all"}),"Clear All Filters"]})]})]})]})})]}),(0,n.jsx)(c,{isOpen:g,onClose:()=>{j(!1),_(null)},case_:f,onSuccess:()=>{j(!1),_(null),y()}})]})}},9116:function(e,s,a){"use strict";a.d(s,{$4:function(){return o},BY:function(){return r},Ey:function(){return h},Kj:function(){return d},r$:function(){return c},tW:function(){return l},xL:function(){return i}});class n{async request(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};try{let a="".concat(this.baseUrl).concat(e),n=await fetch(a,{headers:{"Content-Type":"application/json",...s.headers},...s});if(!n.ok)return{error:(await n.json().catch(()=>({}))).error||"HTTP ".concat(n.status,": ").concat(n.statusText)};return{data:await n.json()}}catch(e){return{error:e instanceof Error?e.message:"Unknown error occurred"}}}async getCasesPendingAssignment(){return this.request("/swcm/cases/pending-assignment")}async assignCaseToSWCM(e,s,a){return this.request("/swcm/cases/".concat(e,"/assign"),{method:"POST",body:JSON.stringify({assigned_worker:s,assigned_supervisor:a})})}async getCasesByWorker(e){return this.request("/cases?assigned_worker=".concat(encodeURIComponent(e)))}async getCaseById(e){return this.request("/cases/".concat(e))}async getPersonsByCase(e){return this.request("/cases/".concat(e,"/persons"))}async getCaseNotes(e){return this.request("/cases/".concat(e,"/notes"))}async addCaseNote(e,s,a){return this.request("/cases/".concat(e,"/notes"),{method:"POST",body:JSON.stringify({note_text:s,note_type:a||"General"})})}async updateCase(e,s){return this.request("/cases/".concat(e),{method:"PUT",body:JSON.stringify(s)})}async searchPersons(e){return this.request("/persons/search?q=".concat(encodeURIComponent(e)))}async getPersonById(e){return this.request("/persons/".concat(e))}async healthCheck(){return this.request("/health")}constructor(e="https://ccwis-core-case-mgmt-807576987550.us-central1.run.app"){this.baseUrl=e}}let t=new n,r=()=>t.getCasesPendingAssignment(),i=(e,s,a)=>t.assignCaseToSWCM(e,s,a),l=e=>t.getCasesByWorker(e),c=(e,s,a)=>t.addCaseNote(e,s,a),o=(e,s)=>t.updateCase(e,s),d=e=>t.searchPersons(e),h=async e=>(await new Promise(e=>setTimeout(e,400)),!e||e.length<2)?{data:{incidents:[]},error:void 0}:{data:{incidents:[{incident_number:"INC-2024-001234",child_first_names:"Emma",child_last_names:"Johnson",parent_first_names:"Michael, Sarah",parent_last_names:"Johnson, Johnson",cps_worker:"Dana Wilson",due_date:"2024-09-15",county_of_assessment:"King County",intake_date:"2024-08-15",reported_native_american_heritage:"No",perpetrators:"Michael Johnson",perpetrator_first_name:"Michael",perpetrator_last_name:"Johnson",findings:"Substantiated",allegations:"Physical abuse",victims:"Emma Johnson",victim_first_name:"Emma",victim_last_name:"Johnson",person_id:"12345",role:"Client",gender:"Female",age_calculated:8,prior_workers:"None",current_address:"123 Main St",address_type:"Residential",residence_county:"King County",date_of_birth:"2016-03-12",phone_number:"206-555-0123",phone_type:"Home",address:"123 Main St",city:"Seattle",state:"WA",zip_code:98101,non_custodial_parent:!1,non_custodial_parent_person_id:"",non_custodial_parent_first_name:"",non_custodial_parent_last_name:"",non_custodial_parent_middle_name:"",non_custodial_parent_dob:"",non_custodial_parent_ssn:"",non_custodial_parent_suffix:"",non_custodial_parent_sex:"",non_custodial_parent_race:"",non_custodial_parent_ethnicity:"",legal_custodian:"Sarah Johnson",guardian:"",prior_assessment:"None",type_of_appointment:"",clinic_name:"",appointment_date:""}].filter(s=>s.incident_number.toLowerCase().includes(e.toLowerCase())||s.child_first_names.toLowerCase().includes(e.toLowerCase())||s.child_last_names.toLowerCase().includes(e.toLowerCase())||s.allegations.toLowerCase().includes(e.toLowerCase()))},error:void 0}},7648:function(e,s,a){"use strict";a.d(s,{default:function(){return t.a}});var n=a(2972),t=a.n(n)}},function(e){e.O(0,[972,971,117,744],function(){return e(e.s=9574)}),_N_E=e.O()}]);